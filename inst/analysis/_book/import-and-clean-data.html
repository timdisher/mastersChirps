<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Import and Clean Data | Masters analysis Report</title>
  <meta name="description" content="2 Import and Clean Data | Masters analysis Report" />
  <meta name="generator" content="bookdown 0.21.10 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Import and Clean Data | Masters analysis Report" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Import and Clean Data | Masters analysis Report" />
  
  
  

<meta name="author" content="Tim Disher" />


<meta name="date" content="2021-04-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="initial-data-exploration.html"/>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // if code block has been labeled with class `fold-show`, show the code on init!
    var classList = $(this).attr('class').split(/\s+/);
    for (var i = 0; i < classList.length; i++) {
    if (classList[i] === 'fold-show') {
        show = true;
      }
    }

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // hack: return show to false, otherwise all next codeBlocks will be shown!
    show = false;

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn {
  margin-bottom: 4px;
}

.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}

.open > .dropdown-menu {
    display: block;
    color: #ffffff;
    background-color: #ffffff;
    background-image: none;
    border-color: #92897e;
}

.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: 400;
  line-height: 1.42857143;
  color: #000000;
  white-space: nowrap;
}

.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
}

.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
  outline: 0;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #aea79f;
}

.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  cursor: not-allowed;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
}

.btn {
  display: inline-block;
  margin-bottom: 1;
  font-weight: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  -ms-touch-action: manipulation;
      touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.42857143;
  border-radius: 4px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #ffffff;
  text-decoration: none;
}
.btn:active,
.btn.active {
  background-image: none;
  outline: 0;
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  filter: alpha(opacity=65);
  opacity: 0.65;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #ffffff;
  background-color: #aea79f; #important
  border-color: #aea79f;
}

.btn-default:focus,
.btn-default.focus {
  color: #ffffff;
  background-color: #978e83;
  border-color: #6f675e;
}

.btn-default:hover {
  color: #ffffff;
  background-color: #978e83;
  border-color: #92897e;
}
.btn-default:active,
.btn-default.active,
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-right: 8px;
  padding-left: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-right: 12px;
  padding-left: 12px;
}
.btn-group.open .dropdown-toggle {
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  box-shadow: none;
}

</style>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Project Information</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#ideas-explored"><i class="fa fa-check"></i><b>1.1</b> Ideas explored</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="import-and-clean-data.html"><a href="import-and-clean-data.html"><i class="fa fa-check"></i><b>2</b> Import and Clean Data</a><ul>
<li class="chapter" data-level="2.1" data-path="import-and-clean-data.html"><a href="import-and-clean-data.html#selection-data"><i class="fa fa-check"></i><b>2.1</b> Selection Data</a></li>
<li class="chapter" data-level="2.2" data-path="import-and-clean-data.html"><a href="import-and-clean-data.html#leaderboard-data"><i class="fa fa-check"></i><b>2.2</b> Leaderboard Data</a></li>
<li class="chapter" data-level="2.3" data-path="import-and-clean-data.html"><a href="import-and-clean-data.html#calculate-daily-scores-for-pool-participants"><i class="fa fa-check"></i><b>2.3</b> Calculate Daily Scores for Pool Participants</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html"><i class="fa fa-check"></i><b>3</b> Initial Data Exploration</a><ul>
<li class="chapter" data-level="3.1" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html#golfer-performance"><i class="fa fa-check"></i><b>3.1</b> Golfer Performance</a></li>
<li class="chapter" data-level="3.2" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html#pool-performance"><i class="fa fa-check"></i><b>3.2</b> Pool Performance</a><ul>
<li class="chapter" data-level="3.2.1" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html#player-choices"><i class="fa fa-check"></i><b>3.2.1</b> Player Choices</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html#player-performance"><i class="fa fa-check"></i><b>3.3</b> Player Performance</a><ul>
<li class="chapter" data-level="3.3.1" data-path="initial-data-exploration.html"><a href="initial-data-exploration.html#overall"><i class="fa fa-check"></i><b>3.3.1</b> Overall</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#player-choice-clustering"><i class="fa fa-check"></i><b>4.1</b> Player Choice Clustering</a><ul>
<li class="chapter" data-level="4.1.1" data-path="analysis.html"><a href="analysis.html#growth-mixture-model"><i class="fa fa-check"></i><b>4.1.1</b> Growth Mixture Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>5</b> Conclusions</a><ul>
<li class="chapter" data-level="5.1" data-path="conclusions.html"><a href="conclusions.html#findings"><i class="fa fa-check"></i><b>5.1</b> Findings</a></li>
<li class="chapter" data-level="5.2" data-path="conclusions.html"><a href="conclusions.html#next-steps"><i class="fa fa-check"></i><b>5.2</b> Next steps</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Masters analysis Report</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="import-and-clean-data" class="section level1">
<h1><span class="header-section-number">2</span> Import and Clean Data</h1>
<div id="selection-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Selection Data</h2>
<p>The original dataset was organized based on how the the pool was run with picks
in columns. We will want to make this much wider by having each golfer as a
column with a binary indicator of whether or not a given member of the pool
selected them. We create some variable tests at the same time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="import-and-clean-data.html#cb1-1"></a><span class="kw">data</span>(<span class="st">&quot;entry_picks_anon&quot;</span>)</span>
<span id="cb1-2"><a href="import-and-clean-data.html#cb1-2"></a></span>
<span id="cb1-3"><a href="import-and-clean-data.html#cb1-3"></a></span>
<span id="cb1-4"><a href="import-and-clean-data.html#cb1-4"></a>wide_dat &lt;-<span class="st"> </span>entry_picks_anon <span class="op">%&gt;%</span></span>
<span id="cb1-5"><a href="import-and-clean-data.html#cb1-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span>alt_name) <span class="op">%&gt;%</span></span>
<span id="cb1-6"><a href="import-and-clean-data.html#cb1-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> value,</span>
<span id="cb1-7"><a href="import-and-clean-data.html#cb1-7"></a>         <span class="dt">value =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-8"><a href="import-and-clean-data.html#cb1-8"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> name, <span class="dt">values_from=</span> value) <span class="op">%&gt;%</span></span>
<span id="cb1-9"><a href="import-and-clean-data.html#cb1-9"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>alt_name), <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>, .)) </span>
<span id="cb1-10"><a href="import-and-clean-data.html#cb1-10"></a></span>
<span id="cb1-11"><a href="import-and-clean-data.html#cb1-11"></a>report &lt;-<span class="st"> </span><span class="kw">data_validation_report</span>()</span>
<span id="cb1-12"><a href="import-and-clean-data.html#cb1-12"></a>golfers &lt;-<span class="st"> </span>entry_picks_anon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>alt_name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span>unique</span>
<span id="cb1-13"><a href="import-and-clean-data.html#cb1-13"></a></span>
<span id="cb1-14"><a href="import-and-clean-data.html#cb1-14"></a>test_picks &lt;-</span>
<span id="cb1-15"><a href="import-and-clean-data.html#cb1-15"></a><span class="st">  </span><span class="kw">all</span>(wide_dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">tot_pick =</span> <span class="kw">rowSums</span>(<span class="kw">across</span>(</span>
<span id="cb1-16"><a href="import-and-clean-data.html#cb1-16"></a>    <span class="st">`</span><span class="dt">Jon Rahm</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">Robert MacIntyre</span><span class="st">`</span></span>
<span id="cb1-17"><a href="import-and-clean-data.html#cb1-17"></a>  ))) <span class="op">%&gt;%</span></span>
<span id="cb1-18"><a href="import-and-clean-data.html#cb1-18"></a><span class="st">    </span><span class="kw">pull</span>(tot_pick) <span class="op">==</span><span class="st"> </span><span class="dv">8</span>)</span>
<span id="cb1-19"><a href="import-and-clean-data.html#cb1-19"></a></span>
<span id="cb1-20"><a href="import-and-clean-data.html#cb1-20"></a><span class="kw">validate</span>(wide_dat, <span class="st">&quot;Validate player selection data&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-21"><a href="import-and-clean-data.html#cb1-21"></a><span class="st">  </span><span class="kw">validate_if</span>(<span class="dt">description =</span> <span class="st">&quot;Verify everyone has 8 picks and nobody has any NA&quot;</span>,</span>
<span id="cb1-22"><a href="import-and-clean-data.html#cb1-22"></a>              <span class="kw">all</span>(test_picks),</span>
<span id="cb1-23"><a href="import-and-clean-data.html#cb1-23"></a>              ) <span class="op">%&gt;%</span></span>
<span id="cb1-24"><a href="import-and-clean-data.html#cb1-24"></a><span class="st">  </span><span class="kw">validate_cols</span>(<span class="dt">description =</span> <span class="st">&quot;Test all values are 0 or 1&quot;</span>,</span>
<span id="cb1-25"><a href="import-and-clean-data.html#cb1-25"></a>                <span class="kw">in_set</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="op">-</span>alt_name) <span class="op">%&gt;%</span></span>
<span id="cb1-26"><a href="import-and-clean-data.html#cb1-26"></a><span class="st">  </span><span class="kw">validate_if</span>(<span class="dt">description =</span> <span class="st">&quot;Test all 272 players are present&quot;</span>,</span>
<span id="cb1-27"><a href="import-and-clean-data.html#cb1-27"></a>              <span class="kw">nrow</span>(wide_dat) <span class="op">==</span><span class="st"> </span><span class="dv">272</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-28"><a href="import-and-clean-data.html#cb1-28"></a><span class="st">  </span><span class="kw">validate_if</span>(<span class="dt">description =</span> <span class="st">&quot;Test all golders are present&quot;</span>,</span>
<span id="cb1-29"><a href="import-and-clean-data.html#cb1-29"></a>              <span class="kw">all</span>(golfers <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(wide_dat))) <span class="op">%&gt;%</span></span>
<span id="cb1-30"><a href="import-and-clean-data.html#cb1-30"></a><span class="st">  </span><span class="kw">add_results</span>(report)</span></code></pre></div>
</div>
<div id="leaderboard-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Leaderboard Data</h2>
<p>The leaderboard data has to be organized in order to allow for calculating the
daily ranks of each player. This data is pulled directly from the <a href="%22https://www.espn.com/golf/leaderboard%22">ESPN
leaderboard</a> using the <code>rvest</code> package. Code for html scraping can be found in
<code>/data-raw/leaderboard.R</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="import-and-clean-data.html#cb2-1"></a><span class="kw">data</span>(<span class="st">&quot;leaderboard&quot;</span>)</span>
<span id="cb2-2"><a href="import-and-clean-data.html#cb2-2"></a></span>
<span id="cb2-3"><a href="import-and-clean-data.html#cb2-3"></a><span class="kw">datatable</span>(leaderboard,</span>
<span id="cb2-4"><a href="import-and-clean-data.html#cb2-4"></a>          <span class="dt">rownames =</span> <span class="ot">FALSE</span>,</span>
<span id="cb2-5"><a href="import-and-clean-data.html#cb2-5"></a>          <span class="dt">colnames =</span> <span class="kw">c</span>(<span class="st">&quot;Player&quot;</span>, </span>
<span id="cb2-6"><a href="import-and-clean-data.html#cb2-6"></a>                       <span class="st">&quot;Position&quot;</span>, </span>
<span id="cb2-7"><a href="import-and-clean-data.html#cb2-7"></a>                       <span class="st">&quot;Total Score&quot;</span>, </span>
<span id="cb2-8"><a href="import-and-clean-data.html#cb2-8"></a>                       <span class="kw">paste</span>(<span class="st">&quot;Day&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)))</span></code></pre></div>
<div id="htmlwidget-d2c05010fb885be581e9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d2c05010fb885be581e9">{"x":{"filter":"none","data":[["Hideki Matsuyama","Will Zalatoris","Jordan Spieth","Xander Schauffele","Jon Rahm","Marc Leishman","Justin Rose","Patrick Reed","Corey Conners","Cameron Smith","Tony Finau","Webb Simpson","Stewart Cink","Kevin Na","Si Woo Kim","Robert MacIntyre","Brian Harman","Tyrrell Hatton","Collin Morikawa","Scottie Scheffler","Harris English","Shane Lowry","Phil Mickelson","Justin Thomas","Viktor Hovland","Paul Casey","Abraham Ancer","Ian Poulter","Louis Oosthuizen","Cameron Champ","Matt Jones","Bubba Watson","Charl Schwartzel","Michael Thompson","Matt Fitzpatrick","Matt Wallace","Ryan Palmer","Martin Laird","Henrik Stenson","Christiaan Bezuidenhout","Gary Woodland","Sebastian Munoz","Mackenzie Hughes","Joaquin Niemann","Bernd Wiesberger","Brendon Todd","Bryson DeChambeau","Tommy Fleetwood","Jason Kokrak","Jose Maria Olazabal","Billy Horschel","Francesco Molinari","Jim Herman","Adam Scott","Sergio Garcia","Daniel Berger","Jimmy Walker","Matt Kuchar","Max Homa","Danny Willett","Kevin Kisner","Brooks Koepka","Dustin Johnson","Lee Westwood","Mike Weir","Lanto Griffin","Dylan Frittelli","Robert Streb","Rory McIlroy","C.T. Pan","Bernhard Langer","Victor Perez","Zach Johnson","Brian Gay","Patrick Cantlay","Ian Woosnam","Jason Day","Carlos Ortiz","Hudson Swafford","Sandy Lyle","Fred Couples","Sungjae Im","Vijay Singh","Larry Mize","Charles Osborne (a)","Joe Long (a)","Tyler Strafaci (a)","Matthew Wolff"],[1,2,3,3,5,5,7,8,8,10,10,12,12,12,12,12,12,18,18,18,21,21,21,21,21,26,26,26,26,26,26,26,26,34,34,34,34,38,38,40,40,40,40,40,40,46,46,46,49,50,50,52,53,54,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[278,279,281,281,282,282,283,284,284,285,285,286,286,286,286,286,286,287,287,287,288,288,288,288,288,289,289,289,289,289,289,289,289,290,290,290,290,291,291,292,292,292,292,292,292,293,293,293,295,296,296,297,298,299,148,148,148,148,148,149,149,149,149,149,149,149,150,150,150,150,151,151,151,152,152,153,153,153,156,156,157,157,159,163,152,154,161,155],[69,70,71,72,72,72,65,70,73,74,74,70,74,75,71,74,69,71,73,73,74,71,75,73,73,73,75,74,76,72,74,74,74,72,74,74,74,74,73,70,73,74,72,75,74,73,76,74,71,75,76,74,76,74,76,75,75,78,74,76,72,74,74,78,78,76,76,75,76,79,74,78,77,78,79,76,77,82,73,81,79,77,79,84,76,82,80,76],[71,68,68,69,72,67,72,75,69,68,66,76,69,70,69,70,69,74,69,72,71,73,72,67,70,74,69,73,70,68,69,70,71,72,70,72,68,71,71,76,72,73,72,71,66,71,67,70,76,71,71,73,70,73,72,73,73,70,74,73,77,75,75,71,71,73,74,75,74,71,77,73,74,74,73,77,76,71,83,75,78,80,80,79,76,72,81,79],[65,71,72,68,72,70,72,70,68,73,73,70,72,70,74,70,74,74,75,71,73,72,69,75,72,73,75,72,72,77,74,73,72,75,73,71,73,72,71,74,75,71,72,70,74,76,75,73,71,75,73,69,76,79,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[73,70,70,72,66,73,74,69,74,70,72,70,71,71,72,72,74,68,70,71,70,72,72,73,73,69,70,70,71,72,72,72,72,71,73,73,75,74,76,72,72,74,76,76,78,73,75,76,77,75,76,81,76,73,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Player<\/th>\n      <th>Position<\/th>\n      <th>Total Score<\/th>\n      <th>Day 1<\/th>\n      <th>Day 2<\/th>\n      <th>Day 3<\/th>\n      <th>Day 4<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The rules for the pool were not entirely clear with respect to handling players
that didn’t make the second day cut, but it seemed to follow that they just kept
their original ranking from the end of day 2. This is a little different from
the official leaderboard, where DQs are dropped to the bottom. We use
<code>rowCumsums</code> to get the cumulative score for each player and then call a quick
custom ranking function to make sure ties are coded correctly. All golfers are
included in the first day and then those in the group that made the day 2 cut
are then separated out after that. Players who don’t make the cut still have
their day 2 ranks carried forward.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="import-and-clean-data.html#cb3-1"></a><span class="co"># Order of variables for later</span></span>
<span id="cb3-2"><a href="import-and-clean-data.html#cb3-2"></a>order &lt;-<span class="st"> </span><span class="kw">quo</span>(<span class="kw">c</span>(player<span class="op">:</span>tot, r1<span class="op">:</span>r4, r1_rank, r2_rank, r3_rank, r4_rank))</span>
<span id="cb3-3"><a href="import-and-clean-data.html#cb3-3"></a>  <span class="co"># Day 1:2</span></span>
<span id="cb3-4"><a href="import-and-clean-data.html#cb3-4"></a>  pre_cut &lt;-<span class="st"> </span></span>
<span id="cb3-5"><a href="import-and-clean-data.html#cb3-5"></a><span class="st">    </span>leaderboard <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(r1<span class="op">:</span>r2) <span class="op">%&gt;%</span></span>
<span id="cb3-6"><a href="import-and-clean-data.html#cb3-6"></a><span class="st">    </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-7"><a href="import-and-clean-data.html#cb3-7"></a><span class="st">    </span>matrixStats<span class="op">::</span><span class="kw">rowCumsums</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Get cumulative score</span></span>
<span id="cb3-8"><a href="import-and-clean-data.html#cb3-8"></a><span class="st">    `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">paste0</span>(<span class="st">&quot;r&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb3-9"><a href="import-and-clean-data.html#cb3-9"></a><span class="st">    </span><span class="kw">cbind</span>(leaderboard <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(r1<span class="op">:</span>r2))) <span class="op">%&gt;%</span></span>
<span id="cb3-10"><a href="import-and-clean-data.html#cb3-10"></a><span class="st">    </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-11"><a href="import-and-clean-data.html#cb3-11"></a><span class="st">      </span><span class="kw">ties</span>(., <span class="dt">var =</span> r1) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Score ties for day 1</span></span>
<span id="cb3-12"><a href="import-and-clean-data.html#cb3-12"></a><span class="st">      </span><span class="kw">ties</span>(., <span class="dt">var =</span> r2) <span class="co"># Score ties for day 2</span></span>
<span id="cb3-13"><a href="import-and-clean-data.html#cb3-13"></a>    </span>
<span id="cb3-14"><a href="import-and-clean-data.html#cb3-14"></a>    </span>
<span id="cb3-15"><a href="import-and-clean-data.html#cb3-15"></a>  </span>
<span id="cb3-16"><a href="import-and-clean-data.html#cb3-16"></a>  <span class="co"># Day 3 on limited to those who made the cut. Start from full leaderboard</span></span>
<span id="cb3-17"><a href="import-and-clean-data.html#cb3-17"></a>  <span class="co"># to make sur eyou get the right cumulative scores</span></span>
<span id="cb3-18"><a href="import-and-clean-data.html#cb3-18"></a>  made_cut &lt;-<span class="st">  </span>leaderboard <span class="op">%&gt;%</span></span>
<span id="cb3-19"><a href="import-and-clean-data.html#cb3-19"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(pos))</span>
<span id="cb3-20"><a href="import-and-clean-data.html#cb3-20"></a>  </span>
<span id="cb3-21"><a href="import-and-clean-data.html#cb3-21"></a>  ranks_made &lt;-<span class="st"> </span>made_cut <span class="op">%&gt;%</span></span>
<span id="cb3-22"><a href="import-and-clean-data.html#cb3-22"></a><span class="st">     </span>dplyr<span class="op">::</span><span class="kw">select</span>(r1,r2,r3,r4) <span class="op">%&gt;%</span></span>
<span id="cb3-23"><a href="import-and-clean-data.html#cb3-23"></a><span class="st">     </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-24"><a href="import-and-clean-data.html#cb3-24"></a><span class="st">     </span>matrixStats<span class="op">::</span><span class="kw">rowCumsums</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># na.rm by default</span></span>
<span id="cb3-25"><a href="import-and-clean-data.html#cb3-25"></a><span class="st">     `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">paste0</span>(<span class="st">&quot;r&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="cb3-26"><a href="import-and-clean-data.html#cb3-26"></a><span class="st">     </span><span class="kw">cbind</span>(made_cut <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(r1,r2,r3,r4))) <span class="op">%&gt;%</span></span>
<span id="cb3-27"><a href="import-and-clean-data.html#cb3-27"></a><span class="st">     </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-28"><a href="import-and-clean-data.html#cb3-28"></a><span class="st">     </span><span class="kw">ties</span>(., <span class="dt">var =</span> r3) <span class="op">%&gt;%</span></span>
<span id="cb3-29"><a href="import-and-clean-data.html#cb3-29"></a><span class="st">     </span><span class="kw">ties</span>(., <span class="dt">var =</span> r4) <span class="op">%&gt;%</span></span>
<span id="cb3-30"><a href="import-and-clean-data.html#cb3-30"></a><span class="st">    </span><span class="kw">left_join</span>(pre_cut <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(player, <span class="kw">ends_with</span>(<span class="st">&quot;rank&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb3-31"><a href="import-and-clean-data.html#cb3-31"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">!!</span><span class="st"> </span>order)</span>
<span id="cb3-32"><a href="import-and-clean-data.html#cb3-32"></a>    </span>
<span id="cb3-33"><a href="import-and-clean-data.html#cb3-33"></a>  </span>
<span id="cb3-34"><a href="import-and-clean-data.html#cb3-34"></a>   ranks_cut &lt;-<span class="st"> </span>pre_cut <span class="op">%&gt;%</span></span>
<span id="cb3-35"><a href="import-and-clean-data.html#cb3-35"></a><span class="st">     </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">is.na</span>(pos)) <span class="op">%&gt;%</span></span>
<span id="cb3-36"><a href="import-and-clean-data.html#cb3-36"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">r3_rank =</span> r2_rank,</span>
<span id="cb3-37"><a href="import-and-clean-data.html#cb3-37"></a>                  <span class="dt">r4_rank =</span> r2_rank) <span class="op">%&gt;%</span></span>
<span id="cb3-38"><a href="import-and-clean-data.html#cb3-38"></a><span class="st">     </span><span class="kw">select</span>(<span class="op">!!</span><span class="st"> </span>order)</span>
<span id="cb3-39"><a href="import-and-clean-data.html#cb3-39"></a></span>
<span id="cb3-40"><a href="import-and-clean-data.html#cb3-40"></a>   </span>
<span id="cb3-41"><a href="import-and-clean-data.html#cb3-41"></a>score_dat &lt;-<span class="st">  </span><span class="kw">rbind</span>(ranks_made, ranks_cut)</span>
<span id="cb3-42"><a href="import-and-clean-data.html#cb3-42"></a></span>
<span id="cb3-43"><a href="import-and-clean-data.html#cb3-43"></a><span class="co"># Add data tests</span></span>
<span id="cb3-44"><a href="import-and-clean-data.html#cb3-44"></a><span class="kw">validate</span>(score_dat, <span class="st">&quot;Validate leaderboard data&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-45"><a href="import-and-clean-data.html#cb3-45"></a><span class="kw">validate_if</span>(<span class="kw">all</span>(ranks_made<span class="op">$</span>pos <span class="op">==</span><span class="st"> </span>ranks_made<span class="op">$</span>r4_rank),</span>
<span id="cb3-46"><a href="import-and-clean-data.html#cb3-46"></a>              <span class="dt">description =</span> <span class="st">&quot;Verify ranks calculated by hand against the current position. If TRUE, assumes the other days are correct as well.&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-47"><a href="import-and-clean-data.html#cb3-47"></a><span class="kw">validate_if</span>(<span class="dt">description =</span> <span class="st">&quot;Test that highest score matches current score. Assume all the other days are correct if passes&quot;</span>,<span class="kw">all</span>(ranks_made<span class="op">$</span>r4 <span class="op">==</span><span class="st"> </span>ranks_made<span class="op">$</span>tot)) <span class="op">%&gt;%</span></span>
<span id="cb3-48"><a href="import-and-clean-data.html#cb3-48"></a><span class="st">  </span><span class="kw">add_results</span>(report)</span></code></pre></div>
</div>
<div id="calculate-daily-scores-for-pool-participants" class="section level2">
<h2><span class="header-section-number">2.3</span> Calculate Daily Scores for Pool Participants</h2>
<p>The final step of data prep is to combine the golfer daily scores with the
player choices in order to calculate the score of each day of the tournament.
This is calculated as the sum of the ranks of the players that each person
chose. For example if your 8 players are in positions 1, 2, 3, 4, 5, 6, 7, 8
then your score would be 36. A first step here however is to correct
some differences in the names between the pool and the ESPN leaderboard. These
are just some small spelling differences that are easier to change in leaderboard
data than the other.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="import-and-clean-data.html#cb4-1"></a>golfers[<span class="op">!</span>golfers <span class="op">%in%</span><span class="st"> </span>score_dat<span class="op">$</span>player]</span></code></pre></div>
<pre><code>## [1] &quot;Bryson Dechambeau&quot; &quot;Ollie Osborne&quot;     &quot;Tyler Strafaci&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="import-and-clean-data.html#cb6-1"></a>score_dat &lt;-<span class="st"> </span>score_dat <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="import-and-clean-data.html#cb6-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">player =</span> <span class="kw">case_when</span>(player <span class="op">==</span><span class="st"> &quot;Bryson DeChambeau&quot;</span> <span class="op">~</span><span class="st"> &quot;Bryson Dechambeau&quot;</span>,</span>
<span id="cb6-3"><a href="import-and-clean-data.html#cb6-3"></a>                            player <span class="op">==</span><span class="st"> &quot;Charles Osborne (a)&quot;</span> <span class="op">~</span><span class="st"> &quot;Ollie Osborne&quot;</span>,</span>
<span id="cb6-4"><a href="import-and-clean-data.html#cb6-4"></a>                            player <span class="op">==</span><span class="st"> &quot;Tyler Strafaci (a)&quot;</span> <span class="op">~</span><span class="st"> &quot;Tyler Strafaci&quot;</span>,</span>
<span id="cb6-5"><a href="import-and-clean-data.html#cb6-5"></a>                            <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>player))</span></code></pre></div>
<p>The final step in data prep is to calculate the daily scores for everyone in the
pool. This is done by looping over rows in the pick data frame and and then
for each user calculate the sum of their player ranks for each day by matching
them to the score data. We test these against the ground-truth official scores
for a few key users and add those results to the validation report. There are
plenty of code inefficiencies here (row-wise operations are pretty slow) and
a better approach would be to also scrape the final results and confirm they
all match instead of just looking at this group. This will have to do for now
though!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="import-and-clean-data.html#cb7-1"></a>pick_dat &lt;-<span class="st"> </span>entry_picks_anon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>alt_name)</span>
<span id="cb7-2"><a href="import-and-clean-data.html#cb7-2"></a></span>
<span id="cb7-3"><a href="import-and-clean-data.html#cb7-3"></a>final_scores &lt;-<span class="st"> </span><span class="kw">apply</span>(pick_dat, <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb7-4"><a href="import-and-clean-data.html#cb7-4"></a></span>
<span id="cb7-5"><a href="import-and-clean-data.html#cb7-5"></a>  <span class="co"># For each set of picks iterate over days</span></span>
<span id="cb7-6"><a href="import-and-clean-data.html#cb7-6"></a>  </span>
<span id="cb7-7"><a href="import-and-clean-data.html#cb7-7"></a>  <span class="kw">map</span>(<span class="kw">paste0</span>(<span class="st">&quot;r&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="st">&quot;_rank&quot;</span>), <span class="op">~</span><span class="st"> </span>{</span>
<span id="cb7-8"><a href="import-and-clean-data.html#cb7-8"></a>    day &lt;-<span class="st"> </span>.</span>
<span id="cb7-9"><a href="import-and-clean-data.html#cb7-9"></a>   rank_day &lt;-<span class="st"> </span>score_dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(player, <span class="kw">all_of</span>(day))</span>
<span id="cb7-10"><a href="import-and-clean-data.html#cb7-10"></a></span>
<span id="cb7-11"><a href="import-and-clean-data.html#cb7-11"></a>   <span class="kw">sum</span>(rank_day[<span class="kw">match</span>(x, rank_day<span class="op">$</span>player), day])</span>
<span id="cb7-12"><a href="import-and-clean-data.html#cb7-12"></a> </span>
<span id="cb7-13"><a href="import-and-clean-data.html#cb7-13"></a>    </span>
<span id="cb7-14"><a href="import-and-clean-data.html#cb7-14"></a>  }) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do.call</span>(cbind, .) <span class="op">%&gt;%</span><span class="st"> </span>as_tibble <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_names</span>(<span class="kw">paste0</span>(<span class="st">&quot;score_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>))</span>
<span id="cb7-15"><a href="import-and-clean-data.html#cb7-15"></a>    </span>
<span id="cb7-16"><a href="import-and-clean-data.html#cb7-16"></a>}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do.call</span>(rbind, .)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">alt_name =</span> entry_picks_anon<span class="op">$</span>alt_name)</span>
<span id="cb7-17"><a href="import-and-clean-data.html#cb7-17"></a></span>
<span id="cb7-18"><a href="import-and-clean-data.html#cb7-18"></a> </span>
<span id="cb7-19"><a href="import-and-clean-data.html#cb7-19"></a>test_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Eastin, John&quot;</span> =<span class="st"> </span><span class="dv">309</span>, <span class="co">#ES1</span></span>
<span id="cb7-20"><a href="import-and-clean-data.html#cb7-20"></a>                <span class="st">&quot;Morlock, Geya&quot;</span> =<span class="st"> </span><span class="dv">276</span>, <span class="co">#ES2</span></span>
<span id="cb7-21"><a href="import-and-clean-data.html#cb7-21"></a>                <span class="st">&quot;Williams, Cameron&quot;</span> =<span class="st"> </span><span class="dv">242</span>, <span class="co">#ES3</span></span>
<span id="cb7-22"><a href="import-and-clean-data.html#cb7-22"></a>                <span class="st">&quot;Ross, Macie&quot;</span> =<span class="st"> </span><span class="dv">252</span>, <span class="co">#ES4</span></span>
<span id="cb7-23"><a href="import-and-clean-data.html#cb7-23"></a>                <span class="st">&quot;el-Afzal, Haazima&quot;</span> =<span class="st"> </span><span class="dv">279</span> <span class="co">#ES5</span></span>
<span id="cb7-24"><a href="import-and-clean-data.html#cb7-24"></a>                ) </span>
<span id="cb7-25"><a href="import-and-clean-data.html#cb7-25"></a></span>
<span id="cb7-26"><a href="import-and-clean-data.html#cb7-26"></a><span class="kw">validate</span>(final_scores, <span class="dt">description =</span> <span class="st">&quot;Validate score calculation algorithm&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-27"><a href="import-and-clean-data.html#cb7-27"></a><span class="st">  </span><span class="kw">validate_if</span>(<span class="dt">description =</span> <span class="st">&quot;Validate final scores against official scores for ES staff&quot;</span>, <span class="kw">all</span>(final_scores <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(alt_name <span class="op">%in%</span><span class="st"> </span><span class="kw">all_of</span>(<span class="kw">names</span>(test_names))) <span class="op">%&gt;%</span></span>
<span id="cb7-28"><a href="import-and-clean-data.html#cb7-28"></a><span class="st">  </span><span class="kw">pull</span>(score_<span class="dv">4</span>) <span class="op">==</span><span class="st"> </span>test_names)) <span class="op">%&gt;%</span></span>
<span id="cb7-29"><a href="import-and-clean-data.html#cb7-29"></a><span class="st">  </span><span class="kw">add_results</span>(report)</span></code></pre></div>
<p>Before printing the validation report let’s add one last detail that might be
interesting. We were provided picks within groups, which I (maybe naively) assumed was organized approximately by player ability. The first three picks
were from group A, the next three from group B, and the final two from group C.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="import-and-clean-data.html#cb8-1"></a>group_a &lt;-<span class="st"> </span>pick_dat[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>unique</span>
<span id="cb8-2"><a href="import-and-clean-data.html#cb8-2"></a>group_b &lt;-<span class="st"> </span>pick_dat[,<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>unique</span>
<span id="cb8-3"><a href="import-and-clean-data.html#cb8-3"></a>group_c &lt;-<span class="st"> </span>pick_dat[,<span class="dv">7</span><span class="op">:</span><span class="dv">8</span>] <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>unique</span>
<span id="cb8-4"><a href="import-and-clean-data.html#cb8-4"></a></span>
<span id="cb8-5"><a href="import-and-clean-data.html#cb8-5"></a>group_dict &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">group =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;A&quot;</span>, <span class="kw">length</span>(group_a)), </span>
<span id="cb8-6"><a href="import-and-clean-data.html#cb8-6"></a>                               <span class="kw">rep</span>(<span class="st">&quot;B&quot;</span>, <span class="kw">length</span>(group_b)), </span>
<span id="cb8-7"><a href="import-and-clean-data.html#cb8-7"></a>                               <span class="kw">rep</span>(<span class="st">&quot;C&quot;</span>, <span class="kw">length</span>(group_c))),</span>
<span id="cb8-8"><a href="import-and-clean-data.html#cb8-8"></a>       <span class="dt">player =</span> <span class="kw">c</span>(group_a, group_b, group_c))</span>
<span id="cb8-9"><a href="import-and-clean-data.html#cb8-9"></a></span>
<span id="cb8-10"><a href="import-and-clean-data.html#cb8-10"></a><span class="co"># Manually add 7 players from group C nobody chose</span></span>
<span id="cb8-11"><a href="import-and-clean-data.html#cb8-11"></a>man &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb8-12"><a href="import-and-clean-data.html#cb8-12"></a>  <span class="dt">group =</span> <span class="st">&quot;C&quot;</span>,</span>
<span id="cb8-13"><a href="import-and-clean-data.html#cb8-13"></a>  <span class="dt">player =</span> <span class="kw">c</span>(</span>
<span id="cb8-14"><a href="import-and-clean-data.html#cb8-14"></a>    <span class="st">&quot;Jim Herman&quot;</span>,</span>
<span id="cb8-15"><a href="import-and-clean-data.html#cb8-15"></a>    <span class="st">&quot;Robert Streb&quot;</span>,</span>
<span id="cb8-16"><a href="import-and-clean-data.html#cb8-16"></a>    <span class="st">&quot;Joe Long (a)&quot;</span>,</span>
<span id="cb8-17"><a href="import-and-clean-data.html#cb8-17"></a>    <span class="st">&quot;Hudson Swafford&quot;</span>,</span>
<span id="cb8-18"><a href="import-and-clean-data.html#cb8-18"></a>    <span class="st">&quot;Sandy Lyle&quot;</span>,</span>
<span id="cb8-19"><a href="import-and-clean-data.html#cb8-19"></a>    <span class="st">&quot;Fred Couples&quot;</span>,</span>
<span id="cb8-20"><a href="import-and-clean-data.html#cb8-20"></a>    <span class="st">&quot;Larry Mize&quot;</span></span>
<span id="cb8-21"><a href="import-and-clean-data.html#cb8-21"></a>  )</span>
<span id="cb8-22"><a href="import-and-clean-data.html#cb8-22"></a>)</span>
<span id="cb8-23"><a href="import-and-clean-data.html#cb8-23"></a></span>
<span id="cb8-24"><a href="import-and-clean-data.html#cb8-24"></a>group_dict &lt;-<span class="st"> </span><span class="kw">rbind</span>(group_dict, man)</span></code></pre></div>
<p>Finally we print the validation report</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="import-and-clean-data.html#cb9-1"></a><span class="kw">print</span>(report)</span></code></pre></div>
<pre><code>## Validation summary: 
##  Number of successful validations: 7
##  Number of failed validations: 0
##  Number of validations with warnings: 0
## 
## Advanced view: 
## 
## 
## |table_name                     |description                                                                                                        |type    | total_violations|
## |:------------------------------|:------------------------------------------------------------------------------------------------------------------|:-------|----------------:|
## |final_scores                   |Validate final scores against official scores for ES staff                                                         |success |               NA|
## |Validate leaderboard data      |Test that highest score matches current score. Assume all the other days are correct if passes                     |success |               NA|
## |Validate leaderboard data      |Verify ranks calculated by hand against the current position. If TRUE, assumes the other days are correct as well. |success |               NA|
## |Validate player selection data |Test all 272 players are present                                                                                   |success |               NA|
## |Validate player selection data |Test all golders are present                                                                                       |success |               NA|
## |Validate player selection data |Test all values are 0 or 1                                                                                         |success |               NA|
## |Validate player selection data |Verify everyone has 8 picks and nobody has any NA                                                                  |success |               NA|</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="initial-data-exploration.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
